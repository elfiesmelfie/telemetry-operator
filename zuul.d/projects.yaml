---
# copied from neutron-operator: https://github.com/openstack-k8s-operators/neutron-operator/blob/main/zuul.d/jobs.yaml
# Something similar exists in nova-operator, which uses podified-multinode-edpm-deployment-crc-3comp as a parent: https://github.com/openstack-k8s-operators/nova-operator/blob/main/.zuul.yaml#L116
- job:
    name: telemetry-operator-tempest-multinode
    parent: podified-multinode-edpm-deployment-crc
    dependencies: ["openstack-k8s-operators-content-provider"]
    vars:
      test_fw: test_operator
      cifmw_test_operator_tempest_container: openstack-tempest-all
      cifmw_test_operator_tempest_image_tag: 'current-podified'
      cifmw_test_operator_tempest_external_plugin:
        - repository: "https://opendev.org/openstack/telemetry-tempest-plugin.git"
          changeRepository: "https://review.opendev.org/openstack/telemetry-tempest-plugin"
          changeRefspec: "master"
      # This value is used to populate the `tempestconfRun` parameter of the Tempest CR: https://openstack-k8s-operators.github.io/test-operator/crds.html#tempest-custom-resource
      # https://github.com/openstack-k8s-operators/ci-framework/blob/main/roles/test_operator/defaults/main.yml
      cifmw_tempest_tempestconf_config:
        debug: true
        # NOTE(gibi): This is a WA to force the publicURL as otherwise
        # tempest gets configured with adminURL and that causes test
        # instability.
        overrides: |
            compute-feature-enabled.vnc_console true
            validation.run_validation true
            identity.v3_endpoint_type public
            identity.v2_admin_endpoint_type public
            service_available.ceilometer true
            service_available.sg_core true
            telemetry.sg_core_service_url "ceilometer.openstack.svc.cluster.local:3000"
      cifmw_test_operator_tempest_include_list: |
        telemetry_tempest_plugin.scenario
        telemetry_tempest_plugin.aodh
      cifmw_test_operator_tempest_exclude_list: ''

- project:
    name: openstack-k8s-operators/telemetry-operator
    #  templates:
    #    - podified-multinode-edpm-pipeline
    github-check:
      jobs:
        - openstack-k8s-operators-content-provider
          # The dependency on the content provider is baked into the job definition.
          # Later, it might be prudent to run the podified-multinode-edpm-deployment-crc job as a provider, and say it provides a "deployed-openstack", so the tempest job can use it as a dependency and not redeploy everything.
        - telemetry-operator-tempest-multinode
          # extends from podified-multinode-edpm-deployment-crc?
          # extends cifmw-base-multinode-tempest
# Here's a sample build for podified-multi-node-edpm-deployment-crc: https://review.rdoproject.org/zuul/build/729e2d8aa3ae4208af587c18c1d3c5e8
#
# Check the logs:
#
# What are the steps here? there is a run playbook, right?
# Is this job a provider job?
# Where is this job defined?
# If this is a provider job, then I can add a job that depends on this and run tempest.
#
# base-minimal
# base-extracted-crc
# cifmw-podified-multinode-edpm-base-crc: https://github.com/openstack-k8s-operators/ci-framework/blob/main/zuul.d/base.yaml#L105
# podified-multi-node-edpm-deployment-crc
#
#
# content provider:
# base-minimal
# base-ci-framework
# cifmw-base-minimal
# openstack-k8s-operators-content-provider: openstack-k8s-operators/ci-framework (main): zuul.d/base.yaml
#
#
