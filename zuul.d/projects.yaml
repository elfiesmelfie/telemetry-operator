---
# copied from neutron-operator: https://github.com/openstack-k8s-operators/neutron-operator/blob/main/zuul.d/jobs.yaml
# Something similar exists in nova-operator, which uses podified-multinode-edpm-deployment-crc-3comp as a parent: https://github.com/openstack-k8s-operators/nova-operator/blob/main/.zuul.yaml#L116
- job:
    name: telemetry-operator-tempest-multinode
    parent: podified-multinode-edpm-deployment-crc
    dependencies: ["openstack-k8s-operators-content-provider"]
    vars:
      # May need to add telemetry to this.
      # * `cifmw_tempest_container`: (String) Name of the tempest container. Default to `openstack-tempest`
      # https://github.com/openstack-k8s-operators/ci-framework/blob/a32669366a32b494b692d5dc73de044fd089a38a/roles/tempest/README.md?plain=1#L14
      cifmw_tempest_container: openstack-tempest-all
      #* `cifmw_tempest_tempestconf_profile`: (Dictionary) List of settings to be overwritten in tempest.conf.
      # https://github.com/openstack-k8s-operators/ci-framework/blob/a32669366a32b494b692d5dc73de044fd089a38a/roles/tempest/README.md?plain=1#L21C4-L21C37
      # Assumption: the config vars passed here are from tempest, and I can follow the tempest configs from upstream/devstack-based deployments to populate this for telemetry
      cifmw_tempest_tempestconf_profile:
        overrides:
            compute-feature-enabled.vnc_console: true
            validation.run_validation: true
            # NOTE(gibi): This is a WA to force the publicURL as otherwise
            # tempest gets configured with adminURL and that causes test
            # instability.
            identity.v3_endpoint_type: public
            identity.v2_admin_endpoint_type: public
            service_available.ceilometer: true
     # NOTE(efoley): First step is to get ANY tempest jobs running to confirm a working config
      cifmw_tempest_tests_allowed: # need to see ciframwework roles that use these vars, to see how to enable telemetry
        - telemetry_tempest_plugin.scenario.telemetry_integration_prometheus_gabbits
      cifmw_tempest_tests_skipped: []

- project:
    name: openstack-k8s-operators/telemetry-operator
    #  templates:
    #    - podified-multinode-edpm-pipeline
    github-check:
      jobs:
        - openstack-k8s-operators-content-provider
          # The dependency on the content provider is baked into the job definition.
        - telemetry-operator-tempest-multinode
